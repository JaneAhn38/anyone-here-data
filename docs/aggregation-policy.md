# Aggregation Policy – Spot Presence

본 문서는 Anyone Here 서비스에서
드라이브 스팟별 현재 인원수(spot_presence)를
어떤 기준으로 계산하는지 정의합니다.

---

## 1. 집계 대상 데이터

- source table: location_logs
- 기준 스팟: spots

location_logs는 사용자의 위치 로그 원본 데이터이며,
spot_presence는 해당 데이터를 기반으로 계산된 집계 결과입니다.

---

## 2. 집계 기준

### 시간 기준

- 최근 N분 이내의 위치 로그만 집계 대상으로 사용
- 기본값: 최근 10분

### 거리 기준

- 사용자의 위치와 스팟 좌표 간 거리가
  지정된 반경 이내일 경우 해당 스팟에 “존재”한다고 판단
- 기본 반경: 300m

---

## 3. 집계 로직 개요

1. location_logs에서 최근 N분 이내 로그 조회
2. 각 로그에 대해 스팟과의 거리 계산
3. 거리 기준을 만족하는 로그만 필터링
4. 스팟별로 중복 사용자 제거 후 인원수 집계
5. 결과를 spot_presence 형태로 저장 또는 반환

---

## 4. spot_presence 데이터 의미

spot_presence는 실시간 데이터가 아닌
일정 기준에 따라 계산된 “현재 추정 인원” 정보이며,
서비스 정책에 따라 집계 기준은 변경될 수 있습니다.
